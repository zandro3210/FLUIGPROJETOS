function createDataset(fields, constraints, sortFields) {				var selectedPublisher = "";								if(constraints!=null && constraints.length>0){				   var constr = constraints[0];				   var fieldName = constr.getFieldName();				   var initialValue = constr.getInitialValue();				   log.info(fieldName);				   if(initialValue!=null){				      if(fieldName!=null && fieldName=="publisherEmail"){		   					      var sql = "SELECT CD_MATRICULA FROM COLABORADOR WHERE E_MAIL = '"+initialValue+"' ";					      var emailDataset = DatasetFactory.getDataset("ds_sql", new Array(sql), null, null);					      if(emailDataset.rowsCount>0){						     selectedPublisher = emailDataset.getValue(0,0);						     log.info("Id " + selectedPublisher + " localizado pelo e-mail " + initialValue);						  }					   }					   else if(fieldName!=null && fieldName=="publisherLogin"){		  					      var sql = "SELECT CD_MATRICULA FROM COLABORADOR WHERE LOGIN = '"+initialValue+"' ";					      var loginDataset = DatasetFactory.getDataset("ds_sql", new Array(sql), null, null);					      if(loginDataset.rowsCount>0){						     selectedPublisher = loginDataset.getValue(0,0);						     log.info("Id " + selectedPublisher + " localizado pelo login " + initialValue);						  }						  					   }					   else if(fieldName!=null && fieldName=="publisherId"){		  					      selectedPublisher = initialValue;					   }				   }				}								log.info("Realizando dataset com o publicador:" + selectedPublisher);								var campos = "";								if(selectedPublisher=="*"){								   campos = "SELECT NR_DOCUMENTO, NR_VERSAO FROM APROVACAO GROUP BY NR_DOCUMENTO, NR_VERSAO";				}else if(selectedPublisher!=""){ 									campos = " SELECT APROVACAO.NR_DOCUMENTO, APROVACAO.NR_VERSAO FROM APROVACAO, DOCUMENTO ";					campos = campos + " WHERE DOCUMENTO.NR_DOCUMENTO = APROVACAO.NR_DOCUMENTO ";					campos = campos + " AND DOCUMENTO.NR_VERSAO = APROVACAO.NR_VERSAO ";					campos = campos + " AND DOCUMENTO.CD_PUBLICADOR = '"+selectedPublisher+"' ";					campos = campos + " GROUP BY APROVACAO.NR_DOCUMENTO, APROVACAO.NR_VERSAO ";				}                var dataset = DatasetFactory.getDataset("ds_sql", new Array(campos), null, null);								var newDataset = DatasetBuilder.newDataset();				newDataset.addColumn("codigo");				newDataset.addColumn("descricao");				newDataset.addColumn("versao");				newDataset.addColumn("autor");				newDataset.addColumn("publicador");				newDataset.addColumn("pend_aprov");				newDataset.addColumn("aprovado");				newDataset.addColumn("observacao");				newDataset.addColumn("dt_att");				newDataset.addColumn("dt_aprov");				var sql = "";								var cacheColleague = new java.util.HashMap();								for(i=0; i< dataset.rowsCount; i++) {				  				   var nrDoc = dataset.getValue(i,0);				   var vrDoc = dataset.getValue(i,1);				   				   				   sql = "SELECT DS_PRINCIPAL_DOCUMENTO, CD_PUBLICADOR, CD_MATRICULA, DT_ATUALIZACAO FROM DOCUMENTO WHERE NR_DOCUMENTO = '"+nrDoc+"' AND NR_VERSAO = '"+vrDoc+"'";				   var datasetDocument = DatasetFactory.getDataset("ds_sql", new Array(sql), null, null);				   var cdPublicador = "";				   var descrDoc = "";				   var cdCriador = "";				   var dtAtualizacao = "";				   if(datasetDocument.rowsCount>0){				     descrDoc = datasetDocument.getValue(0,0);					 cdPublicador = datasetDocument.getValue(0,1) + " - " + getColleagueNameByCache(datasetDocument.getValue(0,1), cacheColleague);					 cdCriador = datasetDocument.getValue(0,2) + " - " + getColleagueNameByCache(datasetDocument.getValue(0,2), cacheColleague);					 dtAtualizacao = formatDate(datasetDocument.getValue(0,3));				   }				   sql = "SELECT CD_MATRICULA, APROVADO, OBSERVACAO, DT_APROVA FROM APROVACAO  WHERE NR_DOCUMENTO = '"+nrDoc+"' AND NR_VERSAO = '"+vrDoc+"' ";				   				   var stringAprInc = "";				   var datasetAprColleague = DatasetFactory.getDataset("ds_sql", new Array(sql), null, null);				   for(j=0; j< datasetAprColleague.rowsCount; j++) {				      var colleague = datasetAprColleague.getValue(j,0);					  var valueApr = datasetAprColleague.getValue(j,1);					  var dataAprv = datasetAprColleague.getValue(j,3);					  var stringApr = "";					  var dataAprovFormat = "";					  if(dataAprv==null|| dataAprv=="null"){					     stringApr = "Sim";					  }else{					     stringApr = "Não";						 dataAprovFormat = formatDate(dataAprv);					  }					  var obs = datasetAprColleague.getValue(j,2);					  if(obs==null){					    obs = "";					  }					  var nmColaborador = colleague + " - " + getColleagueNameByCache(colleague, cacheColleague);					  newDataset.addRow(new Array( nrDoc, descrDoc, vrDoc, cdCriador,cdPublicador, nmColaborador, stringApr, obs, dtAtualizacao,dataAprovFormat));				   }				}				cacheColleague = null;                return newDataset;}function formatDate(dataString){	var s =  new java.lang.String(dataString);	if(s.contains("-")){		var arS = s.split("-");		var y = arS[0];		var m = arS[1];		var d = arS[2];		return d+"/"+m+"/"+y;	}else{	    return  "";	}}function getColleagueNameByCache(colleagueId, cacheColleague){    if(colleagueId==null || colleagueId==""){	   return "Não encontrado";	}   if(cacheColleague.containsKey(colleagueId)){      return cacheColleague.get(colleagueId);   }else{   		var sql = "SELECT NM_COLABORADOR FROM COLABORADOR WHERE CD_MATRICULA = '"+colleagueId+"' ";		var datasetColleague = DatasetFactory.getDataset("ds_sql", new Array(sql), null, null);		if(datasetColleague.rowsCount>0){		   cacheColleague.put(colleagueId, datasetColleague.getValue(0,0));		   return datasetColleague.getValue(0,0);		}else{		   cacheColleague.put(colleagueId, colleagueId);		   return colleagueId;		}   }}