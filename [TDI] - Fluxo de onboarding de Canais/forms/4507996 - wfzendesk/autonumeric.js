/*! autoNumeric.js
* @author: Bob Knothe
* @author: Sokolov Yura aka funny_falcon
* @version: 1.7.5
* Created by Robert J. Knothe on 2010-10-25. Please report any bug at http://www.decorplanit.com/plugin/
* Created by Sokolov Yura on 2010-11-07. http://github.com/funny_falcon
* Copyright (c) 2011 Robert J. Knothe  http://www.decorplanit.com/plugin/
* Copyright (c) 2011 Sokolov Yura aka funny_falcon
* The MIT License (http://www.opensource.org/licenses/mit-license.php)
* Permission is hereby granted, free of charge, to any person
* obtaining a copy of this software and associated documentation
* files (the "Software"), to deal in the Software without
* restriction, including without limitation the rights to use,
* copy, modify, merge, publish, distribute, sublicense, and/or sell
* copies of the Software, and to permit persons to whom the
* Software is furnished to do so, subject to the following
* conditions:
* The above copyright notice and this permission notice shall be
* included in all copies or substantial portions of the Software.
* THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
* EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES
* OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
* NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT
* HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
* WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
* FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
* OTHER DEALINGS IN THE SOFTWARE. */
(function(e){function f(B){var A={};
if(B.selectionStart===undefined){B.focus();var z=document.selection.createRange();A.length=z.text.length;z.moveStart("character",-B.value.length);A.end=z.text.length;A.start=A.end-A.length}else{A.start=B.selectionStart;A.end=B.selectionEnd;A.length=A.end-A.start}return A}function y(B,C,z){if(B.selectionStart===undefined){B.focus();var A=B.createTextRange();A.collapse(true);A.moveEnd("character",z);A.moveStart("character",C);A.select()}else{B.selectionStart=C;B.selectionEnd=z}}function n(z,A){e.each(A,function(C,E){if(typeof(E)==="function"){A[C]=E(z,A,C)}else{if(typeof(E)==="string"){var D=E.substr(0,4);if(D==="fun:"){var B=e.autoNumeric[E.substr(4)];if(typeof(B)==="function"){A[C]=e.autoNumeric[E.substr(4)](z,A,C)}else{A[C]=null}}else{if(D==="css:"){A[C]=e(E.substr(4)).val()}}}}})}function d(A,z){if(typeof(A[z])==="string"){A[z]*=1}}function x(C,B){var F=e.extend({},e.fn.autoNumeric.defaults,B);if(e.metadata){F=e.extend(F,C.metadata())}n(C,F);var E=F.vMax.toString().split(".");var A=(!F.vMin&&F.vMin!==0)?[]:F.vMin.toString().split(".");
d(F,"vMax");d(F,"vMin");d(F,"mDec");F.aNeg=F.vMin<0?"-":"";if(typeof(F.mDec)!=="number"){F.mDec=Math.max((E[1]?E[1]:"").length,(A[1]?A[1]:"").length)}if(F.altDec===null&&F.mDec>0){if(F.aDec==="."&&F.aSep!==","){F.altDec=","}else{if(F.aDec===","&&F.aSep!=="."){F.altDec="."}}}var z=F.aNeg?"([-\\"+F.aNeg+"]?)":"(-?)";F._aNegReg=z;F._skipFirst=new RegExp(z+"[^-"+(F.aNeg?"\\"+F.aNeg:"")+"\\"+F.aDec+"\\d].*?(\\d|\\"+F.aDec+"\\d)");F._skipLast=new RegExp("(\\d\\"+F.aDec+"?)[^\\"+F.aDec+"\\d]\\D*$");var D=(F.aNeg?F.aNeg:"-")+F.aNum+"\\"+F.aDec;if(F.altDec&&F.altDec!==F.aSep){D+=F.altDec}F._allowed=new RegExp("[^"+D+"]","gi");F._numReg=new RegExp(z+"(?:\\"+F.aDec+"?(\\d+\\"+F.aDec+"\\d+)|(\\d*(?:\\"+F.aDec+"\\d*)?))");return F}function r(B,D,C){if(D.aSign){while(B.indexOf(D.aSign)>-1){B=B.replace(D.aSign,"")}}B=B.replace(D._skipFirst,"$1$2");B=B.replace(D._skipLast,"$1");B=B.replace(D._allowed,"");if(D.altDec){B=B.replace(D.altDec,D.aDec)}var z=B.match(D._numReg);B=z?[z[1],z[2],z[3]].join(""):"";if(C){var A="^"+D._aNegReg+"0*(\\d"+(C==="leading"?")":"|$)");
A=new RegExp(A);B=B.replace(A,"$1$2")}return B}function t(A,z,C){if(z&&C){var B=A.split(z);if(B[1]&&B[1].length>C){if(C>0){B[1]=B[1].substring(0,C);A=B.join(z)}else{A=B[0]}}}return A}function s(B,A,z){if(A&&A!=="."){B=B.replace(A,".")}if(z&&z!=="-"){B=B.replace(z,"-")}if(!B.match(/\d/)){B+="0"}return B}function k(B,A,z){if(z&&z!=="-"){B=B.replace("-",z)}if(A&&A!=="."){B=B.replace(".",A)}return B}function u(z,B){z=r(z,B);z=t(z,B.aDec,B.mDec);z=s(z,B.aDec,B.aNeg);var A=+z;return A>=B.vMin&&A<=B.vMax}function v(A,B,z){if(A===""||A===B.aNeg){if(B.wEmpty==="zero"){return A+"0"}else{if(B.wEmpty==="sign"||z){return A+B.aSign}else{return A}}}return null}function g(B,F){B=r(B,F);var E=v(B,F,true);if(E!==null){return E}var z="";if(F.dGroup===2){z=/(\d)((\d)(\d{2}?)+)$/}else{if(F.dGroup===4){z=/(\d)((\d{4}?)+)$/}else{z=/(\d)((\d{3}?)+)$/}}var D=B.split(F.aDec);if(F.altDec&&D.length===1){D=B.split(F.altDec)}var C=D[0];if(F.aSep){while(z.test(C)){C=C.replace(z,"$1"+F.aSep+"$2")}}if(F.mDec!==0&&D.length>1){if(D[1].length>F.mDec){D[1]=D[1].substring(0,F.mDec)
}B=C+F.aDec+D[1]}else{B=C}if(F.aSign){var A=B.indexOf(F.aNeg)!==-1;B=B.replace(F.aNeg,"");B=F.pSign==="p"?F.aSign+B:B+F.aSign;if(A){B=F.aNeg+B}}return B}function w(F,M,B,O){F=(F==="")?"0":F.toString();var A="";var I=0;var P="";var K=(typeof(O)==="boolean"||O===null)?(O?M:0):+O;var z=function(Q){var R=K===0?(/(\.[1-9]*)0*$/):K===1?(/(\.\d[1-9]*)0*$/):new RegExp("(\\.\\d{"+K+"}[1-9]*)0*$");Q=Q.replace(R,"$1");if(K===0){Q=Q.replace(/\.$/,"")}return Q};if(F.charAt(0)==="-"){P="-";F=F.replace("-","")}if(!F.match(/^\d/)){F="0"+F}if(P==="-"&&+F===0){P=""}if((+F)>0){F=F.replace(/^0*(\d)/,"$1")}var L=F.lastIndexOf(".");var H=L===-1?F.length-1:L;var J=(F.length-1)-H;if(J<=M){A=F;if(J<K){if(L===-1){A+="."}while(J<K){var C="000000".substring(0,K-J);A+=C;J+=C.length}}else{if(J>K){A=z(A)}else{if(J===0&&K===0){A=A.replace(/\.$/,"")}}}return P+A}var D=L+M;var E=+F.charAt(D+1);var G=F.substring(0,D+1).split("");var N=(F.charAt(D)===".")?(F.charAt(D-1)%2):(F.charAt(D)%2);if((E>4&&B==="S")||(E>4&&B==="A"&&P==="")||(E>5&&B==="A"&&P==="-")||(E>5&&B==="s")||(E>5&&B==="a"&&P==="")||(E>4&&B==="a"&&P==="-")||(E>5&&B==="B")||(E===5&&B==="B"&&N===1)||(E>0&&B==="C"&&P==="")||(E>0&&B==="F"&&P==="-")||(E>0&&B==="U")){for(I=(G.length-1);
I>=0;I-=1){if(G[I]!=="."){G[I]=+G[I]+1;if(G[I]<10){break}else{if(I>0){G[I]="0"}}}}}G=G.slice(0,D+1);A=z(G.join(""));return P+A}function q(A,z){this.options=z;this.that=A;this.$that=e(A);this.formatted=false;this.io=x(this.$that,this.options);this.value=A.value}q.prototype={init:function(z){this.value=this.that.value;this.io=x(this.$that,this.options);this.ctrlKey=z.ctrlKey;this.cmdKey=z.metaKey;this.shiftKey=z.shiftKey;this.selection=f(this.that);if(z.type==="keydown"||z.type==="keyup"){this.kdCode=z.keyCode}this.which=z.which;this.processed=false;this.formatted=false},setSelection:function(B,z,A){B=Math.max(B,0);z=Math.min(z,this.that.value.length);this.selection={start:B,end:z,length:z-B};if(A===undefined||A){y(this.that,B,z)}},setPosition:function(A,z){this.setSelection(A,A,z)},getBeforeAfter:function(){var A=this.value;var B=A.substring(0,this.selection.start);var z=A.substring(this.selection.end,A.length);return[B,z]},getBeforeAfterStriped:function(){var z=this.getBeforeAfter();z[0]=r(z[0],this.io);z[1]=r(z[1],this.io);
return z},normalizeParts:function(D,B){var E=this.io;B=r(B,E);var C=B.match(/^\d/)?true:"leading";D=r(D,E,C);if((D===""||D===E.aNeg)){if(B>""){B=B.replace(/^0*(\d)/,"$1")}}var A=D+B;if(E.aDec){var z=A.match(new RegExp("^"+E._aNegReg+"\\"+E.aDec));if(z){D=D.replace(z[1],z[1]+"0");A=D+B}}if(E.wEmpty==="zero"&&(A===E.aNeg||A==="")){D+="0"}return[D,B]},setValueParts:function(D,B){var E=this.io;var C=this.normalizeParts(D,B);var A=C.join("");var z=C[0].length;if(u(A,E)){A=t(A,E.aDec,E.mDec);if(z>A.length){z=A.length}this.value=A;this.setPosition(z,false);return true}return false},signPosition:function(){var E=this.io,C=E.aSign,B=this.that;if(C){var A=C.length;if(E.pSign==="p"){var D=E.aNeg&&B.value&&B.value.charAt(0)===E.aNeg;return D?[1,A+1]:[0,A]}else{var z=B.value.length;return[z-A,z]}}else{return[1000,-1]}},expandSelectionOnSign:function(A){var z=this.signPosition();var B=this.selection;if(B.start<z[1]&&B.end>z[0]){if((B.start<z[0]||B.end>z[1])&&this.value.substring(Math.max(B.start,z[0]),Math.min(B.end,z[1])).match(/^\s*$/)){if(B.start<z[0]){this.setSelection(B.start,z[0],A)
}else{this.setSelection(z[1],B.end,A)}}else{this.setSelection(Math.min(B.start,z[0]),Math.max(B.end,z[1]),A)}}},checkPaste:function(){if(this.valuePartsBeforePaste!==undefined){var A=this.getBeforeAfter();var z=this.valuePartsBeforePaste;delete this.valuePartsBeforePaste;A[0]=A[0].substr(0,z[0].length)+r(A[0].substr(z[0].length),this.io);if(!this.setValueParts(A[0],A[1])){this.value=z.join("");this.setPosition(z[0].length,false)}}},skipAllways:function(D){var z=this.kdCode,F=this.which,E=this.ctrlKey,A=this.cmdKey;if(z===17&&D.type==="keyup"&&this.valuePartsBeforePaste!==undefined){this.checkPaste();return false}if((z>=112&&z<=123)||(z>=91&&z<=93)||(z>=9&&z<=31)||(z<8&&(F===0||F===z))||z===144||z===145||z===45){return true}if((E||A)&&z===65){return true}if((E||A)&&(z===67||z===86||z===88)){if(D.type==="keydown"){this.expandSelectionOnSign()}if(z===86){if(D.type==="keydown"||D.type==="keypress"){if(this.valuePartsBeforePaste===undefined){this.valuePartsBeforePaste=this.getBeforeAfter()}}else{this.checkPaste()}}return D.type==="keydown"||D.type==="keypress"||z===67
}if(E||A){return true}if(z===37||z===39){var B=this.io.aSep,G=this.selection.start,C=this.that.value;if(D.type==="keydown"&&B&&!this.shiftKey){if(z===37&&C.charAt(G-2)===B){this.setPosition(G-1)}else{if(z===39&&C.charAt(G)===B){this.setPosition(G+1)}}}return true}if(z>=34&&z<=40){return true}return false},processAllways:function(){var z;if(this.kdCode===8||this.kdCode===46){if(!this.selection.length){z=this.getBeforeAfterStriped();if(this.kdCode===8){z[0]=z[0].substring(0,z[0].length-1)}else{z[1]=z[1].substring(1,z[1].length)}this.setValueParts(z[0],z[1])}else{this.expandSelectionOnSign(false);z=this.getBeforeAfterStriped();this.setValueParts(z[0],z[1])}return true}return false},processKeypress:function(){var D=this.io;var z=String.fromCharCode(this.which);var C=this.getBeforeAfterStriped();var B=C[0],A=C[1];if(z===D.aDec||(D.altDec&&z===D.altDec)||((z==="."||z===",")&&this.kdCode===110)){if(!D.mDec||!D.aDec){return true}if(D.aNeg&&A.indexOf(D.aNeg)>-1){return true}if(B.indexOf(D.aDec)>-1){return true}if(A.indexOf(D.aDec)>0){return true
}if(A.indexOf(D.aDec)===0){A=A.substr(1)}this.setValueParts(B+D.aDec,A);return true}if(z==="-"||z==="+"){if(!D.aNeg){return true}if(B===""&&A.indexOf(D.aNeg)>-1){B=D.aNeg;A=A.substring(1,A.length)}if(B.charAt(0)===D.aNeg){B=B.substring(1,B.length)}else{B=(z==="-")?D.aNeg+B:B}this.setValueParts(B,A);return true}if(z>="0"&&z<="9"){if(D.aNeg&&B===""&&A.indexOf(D.aNeg)>-1){B=D.aNeg;A=A.substring(1,A.length)}this.setValueParts(B+z,A);return true}return true},formatQuick:function(){var G=this.io;var E=this.getBeforeAfterStriped();var D=g(this.value,this.io);var z=D.length;if(D){var B=E[0].split("");var A;for(A=0;A<B.length;A+=1){if(!B[A].match("\\d")){B[A]="\\"+B[A]}}var F=new RegExp("^.*?"+B.join(".*?"));var C=D.match(F);if(C){z=C[0].length;if(((z===0&&D.charAt(0)!==G.aNeg)||(z===1&&D.charAt(0)===G.aNeg))&&G.aSign&&G.pSign==="p"){z=this.io.aSign.length+(D.charAt(0)==="-"?1:0)}}else{if(G.aSign&&G.pSign==="s"){z-=G.aSign.length}}}this.that.value=D;this.setPosition(z);this.formatted=true}};function m(z){var A=z.data("autoNumeric");
if(!A){A={};z.data("autoNumeric",A)}return A}function l(z,A){var C=m(z);var B=C.holder;if(B===undefined&&A){B=new q(z.get(0),A);C.holder=B}return B}function i(z){var A=z.data("autoNumeric");if(A&&A.holder){return A.holder.options}return{}}function j(A){A=A||{};var z=e(this),B=l(z,A);if(B.io.aForm&&(this.value||B.io.wEmpty!=="empty")){z.autoNumericSet(z.autoNumericGet(A),A)}}function c(B){var z=e(B.target),A=l(z);A.init(B);if(A.skipAllways(B)){A.processed=true;return true}if(A.processAllways()){A.processed=true;A.formatQuick();B.preventDefault();return false}else{A.formatted=false}return true}function o(B){var z=e(B.target),A=l(z);var C=A.processed;A.init(B);if(A.skipAllways(B)){return true}if(C){B.preventDefault();return false}if(A.processAllways()||A.processKeypress()){A.formatQuick();B.preventDefault();return false}else{A.formatted=false}}function b(C){var z=e(C.target),A=l(z);A.init(C);var B=A.skipAllways(C);A.kdCode=0;delete A.valuePartsBeforePaste;if(B){return true}if(this.value===""){return true}if(!A.formatted){A.formatQuick()
}}function a(C){var z=e(C.target),B=l(z);B.inVal=z.val();var A=v(B.inVal,B.io,true);if(A!==null){z.val(A)}}function p(E){var A=e(E.target),B=l(A);var F=B.io,D=A.val(),z=D;if(D!==""){D=r(D,F);if(v(D,F)===null&&u(D,F)){D=s(D,F.aDec,F.aNeg);D=w(D,F.mDec,F.mRound,F.aPad);D=k(D,F.aDec,F.aNeg)}else{D=""}}var C=v(D,F,false);if(C===null){C=g(D,F)}if(C!==z){A.val(C)}if(C!==B.inVal){A.change();delete B.inVal}}e.fn.autoNumeric=function(z){return this.each(function(){j.call(this,z)}).unbind(".autoNumeric").bind({"keydown.autoNumeric":c,"keypress.autoNumeric":o,"keyup.autoNumeric":b,"focusin.autoNumeric":a,"focusout.autoNumeric":p})};function h(z){if(typeof(z)==="string"){z=z.replace(/\[/g,"\\[").replace(/\]/g,"\\]");z="#"+z.replace(/(:|\.)/g,"\\$1")}return e(z)}e.autoNumeric={};e.autoNumeric.Strip=function(C){var z=h(C);var B=i(z);if(arguments[1]&&typeof(arguments[1])==="object"){B=e.extend({},B,arguments[1])}var D=x(z,B);var A=h(C).val();A=r(A,D);A=s(A,D.aDec,D.aNeg);if(+A===0){A="0"}return A};e.autoNumeric.Format=function(C,B){var z=h(C);
var A=i(z);if(arguments[2]&&typeof(arguments[2])==="object"){A=e.extend({},A,arguments[2])}B.toString();var D=x(z,A);B=w(B,D.mDec,D.mRound,D.aPad);B=k(B,D.aDec,D.aNeg);if(!u(B,D)){B=w("",D.mDec,D.mRound,D.aPad)}return g(B,D)};e.fn.autoNumericGet=function(){if(arguments[0]){return e.autoNumeric.Strip(this,arguments[0])}return e.autoNumeric.Strip(this)};e.fn.autoNumericSet=function(z){if(arguments[1]){return this.val(e.autoNumeric.Format(this,z,arguments[1]))}return this.val(e.fn.autoNumeric.Format(this,z))};e.autoNumeric.defaults={aNum:"0123456789",aSep:",",dGroup:"3",aDec:".",altDec:null,aSign:"",pSign:"p",vMax:"999999999.99",vMin:"0.00",mDec:null,mRound:"S",aPad:true,wEmpty:"empty",aForm:false};e.fn.autoNumeric.defaults=e.autoNumeric.defaults;e.fn.autoNumeric.Strip=e.autoNumeric.Strip;e.fn.autoNumeric.Format=e.autoNumeric.Format})(jQuery);
